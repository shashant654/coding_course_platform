{% extends 'base.html' %}

{% block title %}My Profile - CodeLearn{% endblock %}

{% block content %}
<div class="container py-5">
  <!-- Header -->
  <div class="row mb-5">
    <div class="col-md-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="mb-1">My Profile</h1>
          <p class="text-muted">Manage your account and personal information</p>
        </div>
        <a href="{% url 'users:edit_profile' %}" class="btn btn-primary">
          <i class="fas fa-edit"></i> Edit Profile
        </a>
      </div>
    </div>
  </div>

  <!-- Profile Content -->
  <div class="row">
    <!-- Left Column - Profile Picture and Basic Info -->
    <div class="col-md-4 mb-4">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <!-- Profile Picture -->
          <div class="mb-4">
            {% if user.profile_picture %}
            <img
              src="{{ user.profile_picture.url }}"
              alt="{{ user.username }}"
              class="img-fluid rounded-circle"
              style="max-width: 150px; height: 150px; object-fit: cover"
            />
            {% else %}
            <div
              class="bg-light rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center"
              style="width: 150px; height: 150px"
            >
              <i class="fas fa-user fa-5x text-muted"></i>
            </div>
            {% endif %}
          </div>

          <!-- User Name -->
          <h4 class="card-title mb-1">{{ user.first_name }} {{ user.last_name }}</h4>
          <p class="text-muted mb-3">@{{ user.username }}</p>

          <!-- Account Type Badge -->
          <div class="mb-3">
            {% if user.is_instructor %}
            <span class="badge bg-success">Instructor</span>
            {% else %}
            <span class="badge bg-primary">Student</span>
            {% endif %}
          </div>

          <!-- Quick Stats -->
          <div class="border-top border-bottom py-3 my-3">
            <div class="row">
              <div class="col-6 mb-2">
                <small class="text-muted">Joined</small>
                <p class="mb-0 fw-bold">{{ user.date_joined|date:"M d, Y" }}</p>
              </div>
              <div class="col-6 mb-2">
                <small class="text-muted">Courses</small>
                <p class="mb-0 fw-bold">0</p>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <a href="{% url 'users:edit_profile' %}" class="btn btn-outline-primary w-100 mb-2">
            Edit Profile
          </a>
          <a href="{% url 'users:dashboard' %}" class="btn btn-outline-secondary w-100">
            Back to Dashboard
          </a>
        </div>
      </div>
    </div>

     <!-- Right Column - Detailed Profile Info -->
    <div class="col-md-8">
      <!-- Two-Factor Authentication Section -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">
            <i class="fas fa-shield-alt"></i> Two-Factor Authentication
          </h5>
        </div>
        <div class="card-body">
          {% if user.two_factor_enabled %}
            <!-- 2FA Enabled -->
            <div class="alert alert-success">
              <div class="d-flex align-items-center">
                <i class="fas fa-check-circle fa-2x me-3"></i>
                <div class="flex-grow-1">
                  <h6 class="alert-heading mb-1">2FA is Enabled</h6>
                  <p class="mb-0 small">Your account is protected with Two-Factor Authentication</p>
                </div>
              </div>
            </div>
            <p class="text-muted">
              You will be asked to enter a verification code sent to your email each time you login.
            </p>
            <a href="{% url 'users:disable_2fa' %}" class="btn btn-outline-danger">
              <i class="fas fa-times-circle"></i> Disable 2FA
            </a>
          {% else %}
            <!-- 2FA Disabled -->
            <div class="alert alert-warning">
              <div class="d-flex align-items-center">
                <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
                <div class="flex-grow-1">
                  <h6 class="alert-heading mb-1">2FA is Disabled</h6>
                  <p class="mb-0 small">Add an extra layer of security to your account</p>
                </div>
              </div>
            </div>
            <p class="text-muted mb-3">
              Two-Factor Authentication adds an extra layer of security to your account. When enabled, you'll need to enter a verification code sent to your email each time you login.
            </p>
            <a href="{% url 'users:enable_2fa' %}" class="btn btn-success">
              <i class="fas fa-shield-alt"></i> Enable 2FA
            </a>
          {% endif %}
        </div>
      </div>

    <!-- Right Column - Detailed Profile Info -->
    <div class="col-md-8">
      <!-- Contact Information -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">
            <i class="fas fa-address-card"></i> Contact Information
          </h5>
        </div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <small class="text-muted d-block">Email Address</small>
              <p class="mb-0">{{ user.email }}</p>
            </div>
            <div class="col-md-6">
              <small class="text-muted d-block">Phone Number</small>
              <p class="mb-0">
                {% if user.phone_number %}{{ user.phone_number }}{% else %}
                <span class="text-muted">Not provided</span>
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Personal Information -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">
            <i class="fas fa-user-circle"></i> Personal Information
          </h5>
        </div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <small class="text-muted d-block">First Name</small>
              <p class="mb-0">{{ user.first_name|default:"Not provided" }}</p>
            </div>
            <div class="col-md-6">
              <small class="text-muted d-block">Last Name</small>
              <p class="mb-0">{{ user.last_name|default:"Not provided" }}</p>
            </div>
          </div>

          {% if user.profile %}
          <div class="row mb-3">
            <div class="col-md-6">
              <small class="text-muted d-block">Profession</small>
              <p class="mb-0">{{ user.profile.profession|default:"Not provided" }}</p>
            </div>
            <div class="col-md-6">
              <small class="text-muted d-block">Website</small>
              <p class="mb-0">
                {% if user.profile.website %}
                <a href="{{ user.profile.website }}" target="_blank">{{ user.profile.website }}</a>
                {% else %}
                <span class="text-muted">Not provided</span>
                {% endif %}
              </p>
            </div>
          </div>

          {% if user.profile.bio %}
          <div class="row">
            <div class="col-12">
              <small class="text-muted d-block">Bio</small>
              <p class="mb-0">{{ user.profile.bio }}</p>
            </div>
          </div>
          {% endif %}
          {% endif %}
        </div>
      </div>

      <!-- Social Links -->
      {% if user.profile %}
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">
            <i class="fas fa-share-alt"></i> Social Links
          </h5>
        </div>
        <div class="card-body">
          <div class="d-flex gap-3">
            {% if user.profile.facebook %}
            <a href="{{ user.profile.facebook }}" target="_blank" class="btn btn-sm btn-outline-primary">
              <i class="fab fa-facebook"></i> Facebook
            </a>
            {% endif %}

            {% if user.profile.twitter %}
            <a href="{{ user.profile.twitter }}" target="_blank" class="btn btn-sm btn-outline-info">
              <i class="fab fa-twitter"></i> Twitter
            </a>
            {% endif %}

            {% if user.profile.linkedin %}
            <a href="{{ user.profile.linkedin }}" target="_blank" class="btn btn-sm btn-outline-primary">
              <i class="fab fa-linkedin"></i> LinkedIn
            </a>
            {% endif %}

            {% if user.profile.github %}
            <a href="{{ user.profile.github }}" target="_blank" class="btn btn-sm btn-outline-dark">
              <i class="fab fa-github"></i> GitHub
            </a>
            {% endif %}

            {% if not user.profile.facebook and not user.profile.twitter and not user.profile.linkedin and not user.profile.github %}
            <p class="text-muted">No social links added</p>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Account Settings -->
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">
            <i class="fas fa-cog"></i> Account Settings
          </h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="{% url 'users:edit_profile' %}" class="btn btn-outline-primary">
              <i class="fas fa-edit"></i> Edit Profile
            </a>
            <button
              class="btn btn-outline-warning"
              data-bs-toggle="modal"
              data-bs-target="#changePasswordModal"
            >
              <i class="fas fa-key"></i> Change Password
            </button>
            <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
              <i class="fas fa-trash"></i> Delete Account
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Change Password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted small">This feature is coming soon.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-danger">
        <h5 class="modal-title text-danger">Delete Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger" role="alert">
          <strong>Warning!</strong> This action cannot be undone. All your data will be permanently deleted.
        </div>
        <p>Are you sure you want to delete your account?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" disabled>Delete Account</button>
      </div>
    </div>
  </div>
</div>

<style>
  .card {
    transition: all 0.3s ease;
  }

  .card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
  }

  .card-header {
    background-color: #f8f9fa;
  }
</style>
{% endblock %}
